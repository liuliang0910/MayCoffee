# 五月咖啡会员积分系统

## 功能概述

完整的会员积分系统,包括:
- ✅ 会员注册/登录
- ✅ 积分获取规则
- ✅ 积分商城
- ✅ 兑换记录
- ✅ 会员等级

## 积分获取规则

### 自动获取
- **注册奖励**: 新用户注册赠送 **10积分**
- **发表留言**: 每次发表留言获得 **5积分**
- **发表回复**: 每次发表回复获得 **2积分**

### 使用积分
- 在积分商城兑换商品会消耗相应积分
- 兑换后积分会自动扣除

## 会员等级

根据积分自动升级:
- **普通会员**: 0-199积分
- **白银会员**: 200-499积分
- **黄金会员**: 500-999积分
- **钻石会员**: 1000积分以上

## 使用流程

### 1. 初始化兑换商品

首次使用需要添加兑换商品数据:

```bash
# 在项目目录下运行
python3 init_redemption_items.py
```

这会在数据库中添加8个示例兑换商品:
- 美式咖啡券 (50积分)
- 拿铁咖啡券 (80积分)
- 手工曲奇饼干 (100积分)
- 精品咖啡豆 (200积分)
- 五月咖啡马克杯 (300积分)
- 咖啡月卡 (500积分)
- 手冲咖啡体验课 (800积分)
- VIP年卡 (1000积分)

### 2. 用户注册

1. 访问网站任意页面
2. 点击导航栏的"会员中心"
3. 点击"注册"标签
4. 填写用户名、邮箱、密码(必填)和手机号(可选)
5. 点击"注册"按钮
6. 注册成功后自动获得10积分

### 3. 用户登录

1. 在会员中心页面点击"登录"标签
2. 输入用户名和密码
3. 登录成功后跳转到会员中心

### 4. 赚取积分

**方式1: 发表留言**
1. 登录后访问"客户留言"页面
2. 发表留言
3. 自动获得5积分,并显示提示"恭喜获得5积分"

**方式2: 发表回复**
1. 登录后在留言详情页
2. 发表回复
3. 自动获得2积分,并显示提示"恭喜获得2积分"

### 5. 兑换商品

1. 登录后访问会员中心
2. 点击"积分商城"标签
3. 浏览兑换商品列表
4. 如果积分足够,点击"立即兑换"
5. 确认兑换后,积分自动扣除
6. 在"兑换记录"中查看兑换状态
7. 凭兑换记录到店领取商品

### 6. 查看积分记录

在会员中心的"积分记录"标签可以查看:
- 每次积分变化的详细记录
- 积分来源(注册奖励、发表留言、发表回复、兑换商品等)
- 积分变化时间

## 页面说明

### member.html (会员登录/注册页)
- 未登录用户访问的页面
- 包含登录和注册两个标签页
- 简洁的表单设计

### member-center.html (会员中心)
- 登录后的主页面
- 显示会员信息:用户名、等级、当前积分
- 三个标签页:
  - 积分记录: 查看所有积分变化
  - 积分商城: 浏览和兑换商品
  - 兑换记录: 查看已兑换的商品

## 数据库结构

### Member (会员表)
- id: 主键
- username: 用户名(唯一)
- email: 邮箱(唯一)
- password: 密码(SHA256加密)
- phone: 手机号
- points: 当前积分
- level: 会员等级
- avatar: 头像
- created_at: 注册时间
- last_login: 最后登录时间

### PointRecord (积分记录表)
- id: 主键
- member_id: 会员ID(外键)
- points: 积分变化(正数为增加,负数为减少)
- reason: 变化原因
- created_at: 记录时间

### RedemptionItem (兑换商品表)
- id: 主键
- name: 商品名称
- points_required: 所需积分
- description: 商品描述
- image: 商品图片
- stock: 库存
- is_active: 是否启用
- created_at: 创建时间

### Redemption (兑换记录表)
- id: 主键
- member_id: 会员ID(外键)
- item_id: 商品ID(外键)
- points_spent: 消耗积分
- status: 状态(待领取/已领取/已取消)
- created_at: 兑换时间

## API接口

### 会员相关
- `POST /api/member/register` - 会员注册
- `POST /api/member/login` - 会员登录
- `POST /api/member/logout` - 会员登出
- `GET /api/member/info` - 获取当前会员信息
- `GET /api/member/points/records` - 获取积分记录

### 兑换相关
- `GET /api/redemption/items` - 获取兑换商品列表
- `POST /api/redemption/redeem` - 兑换商品
- `GET /api/member/redemptions` - 获取兑换记录

## 安全说明

### 密码加密
- 使用 SHA256 对密码进行加密存储
- 生产环境建议使用 bcrypt 等更强的加密方式

### Session 管理
- 使用 Flask Session 管理登录状态
- 登录后将 member_id 存储在 session 中
- 所有需要登录的接口都会检查 session

### 权限控制
- 未登录用户访问会员中心会自动跳转到登录页
- 发表留言和回复不强制登录,但登录后才能获得积分

## 自定义商品

如果要添加自定义商品,可以:

**方式1: 修改初始化脚本**
编辑 `init_redemption_items.py` 中的 `sample_items` 列表

**方式2: 直接操作数据库**
可以创建管理后台来管理兑换商品(未来功能)

## 注意事项

1. **首次运行**: 必须先运行 `init_redemption_items.py` 初始化商品数据
2. **数据备份**: 会员数据很重要,记得定期备份 `messages.db`
3. **图片链接**: 示例商品使用的是 Unsplash 外部图片,建议替换为本地图片
4. **积分规则**: 可以在 `app.py` 中修改积分获取规则
5. **会员等级**: 可以在 `add_points()` 函数中修改等级划分标准

## 后续优化建议

1. **密码找回功能** - 通过邮箱找回密码
2. **头像上传** - 允许会员上传自定义头像
3. **签到功能** - 每日签到获取积分
4. **邀请好友** - 邀请新用户注册获得奖励积分
5. **消费返积分** - 实际消费金额转换为积分
6. **积分有效期** - 设置积分过期时间
7. **会员专属优惠** - 不同等级享受不同折扣
8. **积分转赠** - 会员之间可以转赠积分
9. **管理后台** - 管理商品、查看会员统计等
10. **手机端优化** - 针对手机屏幕优化会员中心页面

## 完成状态

- ✅ 数据库设计
- ✅ 后端API实现
- ✅ 会员注册/登录页面
- ✅ 会员中心页面
- ✅ 积分自动获取
- ✅ 积分商城
- ✅ 兑换功能
- ✅ 导航栏集成
- ✅ 初始化脚本
- ✅ 说明文档

**会员系统已全部完成!** 🎉
